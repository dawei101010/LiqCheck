# 结算结果比对

1. 自动模式，查找新老系统结算任务状态
1. 根据结算起止日期（默认为当日）查找FEE\_LIQ\_RESULT结算数据
2. 查找LIQ\_DETAIL新系统结算数据
3. 新系统数据无，查看结算任务是否已执行，记录CK\_LOG
4. 老系统无，查找老系统结算任务信息TASK\_INFO,记录CK\_LOG
5. 比对两边结算数据，比对结果插入CK\_LIQ\_RESULTE,保存两边原结算信息及数据差异信息、比对状态
6. 查找比对状态不一致的比对明细,记录到CK\_LOG
7. 根据比对状态处理比对结果,记录到CK\_LOG\_DL
    + 单边账
     + 新系统有，老系统无
        + 查找新老系统上次结算日期
        + 查找新系统结算对应的交易明细
        + 逐笔交易依次从老系统查找
         + 交易存在已结算，设置老系统结算日期，FEE\_BATCH\_ID
         + 交易存在未结算，设置状态
         + 交易不存在，设置状态
     + 老系统有，新系统无
        + 查找老系统结算对应的交易明细
        + 逐笔交易依次从新系统查找
         + 交易存在已结算，设置新系统结算日期，结算批次
         + 交易存在未结算，设置新系统PAY_DATE
         + 交易不存在，设置状态
    + 手续费不一致
     + 查询新系统交易明细
     + 查询老系统交易明细
     + 依次比对各交易明细手续费明细是否一致
     + 不一致
        + 设置新老数据保存至CK\_TRANS\_LOG
        + 设置手续费差额，查找新老系统计费公式
            + 计费公式不一致，设置明细比对状态，为计费公式不一致
            + 计费公式一致，设置明细比对状态为未知原因
     + 一致
        + 设置CK\_LIQ\_RESULTE.CK\_RESULT=4
